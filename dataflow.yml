flow: HomeAutomation
operators:
  - id : LuminosityNorm
    uri: file:///Users/gabri/Workspace/zenoh-ifttt-demo/luminosity-normalization/normalization.py
    inputs:
        - id: LuminosityRaw
          type: float
    outputs:
        - id: LuminosityNorm
          type: float
  - id: Detection
    uri: file:///root/zenoh-iftdt-demo/face-detect/detect.py
    configuration:
      net_cfg: /root/zenoh-iftdt-demo/face-detect/yolov3-face.cfg
      net_weights: /root/zenoh-iftdt-demo/face-detect/yolov3-wider_16000.weights
      classes: /root/zenoh-iftdt-demo/face-detect/face_classes.txt
    inputs:
      - id: Image
        type: frame
    outputs:
      - id: Faces
        type: face_array
  - id: Recognition
    uri: file:///root/zenoh-iftdt-demo/recognition/recog.py
    configuration:
      weights: /root/zenoh-iftdt-demo/recognition/facenet_keras_weights.h5
      encodings: /root/zenoh-iftdt-demo/recognition/encodings.pkl
    inputs:
      - id: Faces
        type: face_array
    outputs:
      - id: People
        type: people_array
  - id: SensorFusion
    uri: file:///Users/gabri/Workspace/zenoh-ifttt-demo/sensor-fusion/sensor-fusion.py
    inputs:
      - id: People
        type: people_array
      - id: Luminosity
        type: float
    outputs:
      - id: Lamps
        type: lamp_dict
sources:
  - id : Luminosity
    uri: file:///Users/gabri/Workspace/zenoh-ifttt-demo/luminosity-source-bridge/bridge.py
    configuration:
      key-expr: "/paris/saint-aubin/office/rooms/jl-gb/sensor/luminosity"
    output:
        id: LuminosityRaw
        type: float
  - id : Camera
    uri: file:///Users/gabri/Workspace/zenoh-ifttt-demo/camera-source/camera.py
    configuration:
      fps: 15
    output:
        id: Capture
        type: frame
sinks:
  - id : AlexaSink
    uri: file:///Users/gabri/Workspace/zenoh-ifttt-demo/alexa-sink/alexa-sink.py
    configuration:
      code: aa
      client_id: bb
      client_secret: cc
      refresh_token: dd
      person_mapping: ["Gabriele_Baldoni"]
    input:
        id: Data
        type: lamp_dict
links:
- from:
    node : Camera
    output : Capture
  to:
    node : Detection
    input : Image
- from:
    node : Detection
    output : Faces
  to:
    node : Recognition
    input : Faces
- from:
    node : Recognition
    output : People
  to:
    node : SensorFusion
    input : People
- from:
    node : SensorFusion
    output : Lamps
  to:
    node : AlexaSink
    input : Data
- from:
    node : Luminosity
    output : LuminosityRaw
  to:
    node : LuminosityNorm
    input : LuminosityRaw
- from:
    node : LuminosityNorm
    output : LuminosityNorm
  to:
    node : SensorFusion
    input : Luminosity

mapping:
  Detection: cuda
  Recognition: cuda
  Camera: mac
  SensorFusion: mac
  LuminosityNorm: mac
  Luminosity: mac
  AlexaSink: mac